import os
import numpy as np
import matplotlib.pyplot as plt
plt.rcParams["figure.figsize"] = (10, 7.7)

steps = [3, 6, 12, 18, 24]

threshs_per_step = {
    3: [0.001, 0.005, 0.01, 0.02, 0.05, 0.1],
    6: [0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.15],
    12: [0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.15, 0.2],
    18: [0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.15, 0.2, 0.3],
    24: [0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.15, 0.2, 0.3]
}

# This can be copied from the sheet logger.
data = {
    'Zero-Velocity': {
        3: [0.325807124376297, 0.529923379421234, 0.674462080001831, 0.817191600799561, 0.943624258041382,
            0.983239233493805],
        6: [0.30181610584259, 0.455905288457871, 0.577054858207703, 0.718284428119659, 0.881874263286591,
            0.955444812774658, 0.977492094039917],
        12: [0.283563882112503, 0.392251819372177, 0.486059039831162, 0.610314249992371, 0.790313422679901,
             0.900200366973877, 0.942490875720978, 0.963314056396484],
        18: [0.275701969861984, 0.362413734197617, 0.441952496767044, 0.552504360675812, 0.730859518051148,
             0.85571277141571, 0.910407483577728, 0.939451932907105, 0.968123018741608],
        24: [0.271142154932022, 0.344521045684814, 0.41461193561554, 0.515708267688751, 0.68913459777832,
             0.821881949901581, 0.88407438993454, 0.918735206127167, 0.954718410968781]},
    'Seq2seq-sampling': {
        3: [0.240577399730682, 0.492837101221085, 0.664413690567017, 0.828645765781403, 0.956645309925079,
            0.987954080104828],
        6: [0.223046526312828, 0.394989371299744, 0.549324214458466, 0.717981815338135, 0.900043964385986,
            0.967621982097626, 0.984584391117096],
        12: [0.212327226996422, 0.31864258646965, 0.432670921087265, 0.592302441596985, 0.805085003376007,
             0.920223236083984, 0.958979189395905, 0.975724875926971],
        18: [0.208438023924828, 0.285780668258667, 0.377034664154053, 0.518906533718109, 0.739419460296631,
             0.878030359745026, 0.932708084583283, 0.958837926387787, 0.981005132198334],
        24: [0.206449702382088, 0.267422795295715, 0.344229370355606, 0.469893544912338, 0.692015826702118,
             0.843769729137421, 0.909002959728241, 0.942506790161133, 0.972643613815308]},
    'Seq2seq-sampling-SPL': {
        3: [0.32672855257988, 0.552932500839233, 0.711575448513031, 0.857459306716919, 0.963949620723724,
            0.989460706710815],
        6: [0.300423830747604, 0.472393751144409, 0.607667624950409, 0.759241580963135, 0.916478633880615,
            0.972615897655487, 0.986797273159027],
        12: [0.276745557785034, 0.403837084770203, 0.510275483131409, 0.648190915584564, 0.835030257701874,
             0.932311236858368, 0.965198993682861, 0.979383707046509],
        18: [0.263281553983688, 0.371139377355576, 0.462115496397018, 0.587358772754669, 0.778951764106751,
             0.896720349788666, 0.942557036876679, 0.964572906494141, 0.983033061027527],
        24: [0.254204779863358, 0.351390600204468, 0.43283224105835, 0.549273669719696, 0.739624798297882,
             0.868225753307343, 0.922591626644135, 0.950313806533814, 0.975671947002411]},
    'RNN': {
        3: [0.316660016775131, 0.548668444156647, 0.711178600788117, 0.859483897686005, 0.967420101165772,
            0.991081655025482],
        6: [0.28768852353096, 0.462039321660996, 0.597797453403473, 0.751997888088226, 0.913902759552002,
            0.973345696926117,
            0.987432777881622],
        12: [0.256240218877792, 0.3907890021801, 0.493188470602036, 0.627705633640289, 0.817474126815796,
             0.922822952270508,
             0.959517240524292, 0.975580275058746],
        18: [0.240889072418213, 0.356150895357132, 0.442229419946671, 0.560531675815582, 0.748040795326233,
             0.873878240585327, 0.926667213439941, 0.95309191942215, 0.977197229862213],
        24: [0.232065036892891, 0.3351149559021, 0.411158233880997, 0.517073690891266, 0.697430849075317,
             0.832927644252777,
             0.89551168680191, 0.929842948913574, 0.963684797286987]},
    'RNN-SPL': {
        3: [0.353120803833008, 0.653289139270783, 0.813761472702026, 0.926675021648407, 0.986521422863007,
            0.995103657245636],
        6: [0.31702321767807, 0.543418824672699, 0.697229206562042, 0.843203723430634, 0.958753883838654,
            0.988791465759277,
            0.99400395154953],
        12: [0.291500419378281, 0.4454365670681, 0.572311460971832, 0.721149682998657, 0.891606390476227,
             0.962089836597443,
             0.981398105621338, 0.988929271697998],
        18: [0.281006395816803, 0.400048226118088, 0.507165312767029, 0.645437777042389, 0.833064615726471,
             0.930957138538361, 0.963555037975311, 0.977845191955566, 0.989212989807129],
        24: [0.27414608001709, 0.373434633016586, 0.467000484466553, 0.594673216342926, 0.786266028881073,
             0.901584327220917, 0.944734752178192, 0.96541166305542, 0.982818901538849]},
    'Seq2seq': {
        3: [0.233730480074883, 0.463969618082047, 0.643866360187531, 0.816377878189087, 0.956356227397919,
            0.988781273365021],
        6: [0.21877558529377, 0.366868525743485, 0.512429535388947, 0.68304443359375, 0.882052481174469,
            0.963229954242706,
            0.983558833599091],
        12: [0.209611669182777, 0.296173214912415, 0.393635869026184, 0.537036120891571, 0.752219915390015,
             0.890429556369782, 0.942694365978241, 0.966058254241943],
        18: [0.206470713019371, 0.267197161912918, 0.340641170740128, 0.459458976984024, 0.664570748806,
             0.820671200752258,
             0.893933713436127, 0.932346105575562, 0.967130959033966],
        24: [0.204870820045471, 0.251156330108643, 0.310415238142014, 0.412500977516174, 0.604487240314484,
             0.764602184295654, 0.848117291927338, 0.897160530090332, 0.946686089038849]},
    'Seq2seq-SPL': {
        3: [0.332970172166824, 0.613512396812439, 0.777878940105438, 0.906558096408844, 0.981954634189606,
            0.994309902191162],
        6: [0.302014499902725, 0.504244029521942, 0.65105277299881, 0.802051723003388, 0.940711796283722,
            0.983262777328491,
            0.991982758045197],
        12: [0.281322479248047, 0.411766886711121, 0.523923873901367, 0.664048850536346, 0.846309423446655,
             0.938391387462616, 0.968814074993134, 0.981657028198242],
        18: [0.269266426563263, 0.370725780725479, 0.461392521858215, 0.584096848964691, 0.772043108940125,
             0.889174997806549, 0.936626017093658, 0.960176467895508, 0.980721592903137],
        24: [0.262258112430573, 0.347288727760315, 0.42384734749794, 0.532675981521606, 0.715969085693359,
             0.846617221832275, 0.905198574066162, 0.936821758747101, 0.967152774333954]},
    'Seq2seq-dropout': {
        3: [0.284752726554871, 0.575753450393677, 0.753107607364655, 0.893630981445313, 0.978726208209992,
            0.993751704692841],
        6: [0.248816549777985, 0.453056961297989, 0.608128368854523, 0.772471427917481, 0.9294393658638,
            0.980377435684204,
            0.990967273712158],
        12: [0.228159800171852, 0.354543536901474, 0.46412268280983, 0.610391676425934, 0.815495073795319,
             0.925106227397919, 0.962352216243744, 0.978285610675812],
        18: [0.219295769929886, 0.311283946037293, 0.395812153816223, 0.518230557441711, 0.722464621067047,
             0.862863540649414, 0.921569108963013, 0.950832068920136, 0.97651344537735],
        24: [0.214508935809135, 0.287274152040482, 0.356007218360901, 0.460181385278702, 0.652587950229645,
             0.807231485843658, 0.880580365657806, 0.920020759105682, 0.958826243877411]},
    'Seq2seq-dropout-SPL': {
        3: [0.363862037658691, 0.676654815673828, 0.829829454421997, 0.935035228729248, 0.98781281709671,
            0.995271682739258],
        6: [0.321812063455582, 0.551459610462189, 0.699764728546143, 0.839931666851044, 0.955834865570068,
            0.987654745578766, 0.993529736995697],
        12: [0.292895972728729, 0.444900184869766, 0.563843607902527, 0.7019944190979, 0.871882855892181,
             0.951732218265533,
             0.975736618041992, 0.985551297664642],
        18: [0.281462609767914, 0.397202074527741, 0.495929777622223, 0.62139618396759, 0.80214124917984,
             0.909692227840424,
             0.95012354850769, 0.968950271606445, 0.98491507768631],
        24: [0.272332578897476, 0.369657188653946, 0.455010771751404, 0.569272220134735, 0.749501645565033,
             0.872115790843964, 0.923818171024323, 0.950426518917084, 0.974874019622803]},
    'QuaterNet': {
        3: [0.320399522781372, 0.592857182025909, 0.759503543376923, 0.89409464597702, 0.977656662464142,
            0.993065655231476],
        6: [0.291189104318619, 0.492396473884583, 0.640758693218231, 0.794541835784912, 0.937382280826569,
            0.981453478336334, 0.990792334079742],
        12: [0.266760766506195, 0.404901474714279, 0.522689640522003, 0.668206930160523, 0.853330910205841,
             0.943872690200806, 0.971749722957611, 0.982827246189117],
        18: [0.254185646772385, 0.364672422409058, 0.462516844272614, 0.594966769218445, 0.788432657718658,
             0.904630661010742, 0.947704195976257, 0.967664420604706, 0.983921885490418],
        24: [0.244557023048401, 0.341342121362686, 0.425263166427612, 0.546947300434113, 0.740422427654266,
             0.871289730072022, 0.924651086330414, 0.951601684093475, 0.975357353687286]},
    'QuaterNet-SPL': {
        3: [0.326277881860733, 0.60502415895462, 0.773325204849243, 0.903894364833832, 0.981181144714356,
            0.993892967700958],
        6: [0.294054299592972, 0.501674711704254, 0.653924524784088, 0.807136118412018, 0.944821059703827,
            0.984547436237335, 0.99220472574234],
        12: [0.269247621297836, 0.412313312292099, 0.534355700016022, 0.681762874126434, 0.8651482462883,
             0.951150178909302,
             0.975857555866242, 0.985554695129395],
        18: [0.257119208574295, 0.370340049266815, 0.47274124622345, 0.608152866363525, 0.801813781261444,
             0.913911283016205, 0.954134106636047, 0.971778333187103, 0.986500084400177],
        24: [0.24856561422348, 0.344658762216568, 0.434137105941772, 0.559269070625305, 0.753921985626221,
             0.88129448890686,
             0.932252168655396, 0.956899881362915, 0.978790938854218]}}


prop_cycle = plt.rcParams['axes.prop_cycle']
colors = prop_cycle.by_key()['color']

rnn_spl_color = colors[1]
base_color = colors[0]
zero_vel_color = 'k'
spl_style = '-'
non_spl_style = '--'
steps_to_visualize = [3, 6, 12, 18, 24]

to_visualize = [[("Zero-Velocity", non_spl_style, zero_vel_color),
                 ("Seq2seq-sampling", non_spl_style, base_color),
                 ("Seq2seq-sampling-SPL", spl_style, base_color),
                 ("RNN-SPL", spl_style, rnn_spl_color)],
                [("Zero-Velocity", non_spl_style, zero_vel_color),
                 ("Seq2seq", non_spl_style, base_color),
                 ("Seq2seq-SPL", spl_style, base_color),
                 ("RNN-SPL", spl_style, rnn_spl_color)],
                [("Zero-Velocity", non_spl_style, zero_vel_color),
                 ("Seq2seq-dropout", non_spl_style, base_color),
                 ("Seq2seq-dropout-SPL", spl_style, base_color),
                 ("RNN-SPL", spl_style, rnn_spl_color)],
                [("Zero-Velocity", non_spl_style, zero_vel_color),
                 ("QuaterNet", non_spl_style, base_color),
                 ("QuaterNet-SPL", spl_style, base_color),
                 ("RNN-SPL", spl_style, rnn_spl_color)],
                ]

titles = ['Seq2seq-sampling', 'Seq2seq', 'Seq2seq-dropout', 'QuaterNet']

legend_fontsize = 12
axes_fontsize = 12

for pred_horizon in steps_to_visualize:

    fig, axes = plt.subplots(2, 2, sharey=True)

    for p in range(2):
        for k in range(2):
            ax = axes[p, k]
            idx = k * 2 + p
            pcks = to_visualize[idx]
            threshs = threshs_per_step[pred_horizon]

            for label, linestyle, color in pcks:
                pck = data[label][pred_horizon]
                ax.plot(threshs, np.array(pck) * 100, linestyle, label=label, color=color)
                        # marker='o', markersize=3)
            # ax.set_xticks(threshs)
            # ax.set_xticklabels([str(x) for x in threshs], fontsize=9)

            # if p == 1:
            ax.set_xlabel('threshold', fontsize=axes_fontsize)
            # if k == 0:
            ax.set_ylabel('% of correct keypoints', fontsize=axes_fontsize)
            ax.legend(fontsize=legend_fontsize, loc='lower right')
            ax.grid(alpha=0.5)
            ax.set_title(titles[idx], fontsize=legend_fontsize)

    fig.tight_layout()
    fig.suptitle("Prediction Horizon {} ms.".format(int(pred_horizon/60*1000)))
    plt.subplots_adjust(top=0.9)
    fig.savefig(os.path.join('../imgs', 'pck_{}ms.png'.format(int(pred_horizon/60*1000))), transparent=True)

    # plt.show()
